
<!DOCTYPE html>
<html>

            const wsUrl = `wss://codenames-u88n.onrender.com/ws?room=${roomId}`;<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Codenames Online</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #1a1a2e;
            color: white;
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 800px; margin: 0 auto; }
        header { text-align: center; margin-bottom: 30px; }
        h1 { color: #4cc9f0; margin-bottom: 10px; }
        .room-info { background: #16213e; padding: 15px; border-radius: 10px; margin-bottom: 20px; }
        #roomDisplay { font-family: monospace; font-size: 1.5em; color: #f72585; }
        .status {
            padding: 15px; border-radius: 10px; margin: 15px 0;
            background: #0f3460; text-align: center;
        }
        .connected { background: #2a9d8f; }
        .error { background: #e63946; }
        .board {
            display: grid; grid-template-columns: repeat(5, 1fr);
            gap: 10px; margin: 30px 0;
        }
        .card {
            aspect-ratio: 3/4; background: #f1faee;
            border-radius: 8px; display: flex;
            align-items: center; justify-content: center;
            color: #1d3557; font-weight: bold;
            cursor: pointer; user-select: none;
            transition: all 0.3s; padding: 10px;
            text-align: center; word-break: break-word;
            border: 3px solid transparent;
        }
        .card:hover { transform: translateY(-5px); border-color: #4cc9f0; }
        .card.red { background: #e63946; color: white; }
        .card.blue { background: #457b9d; color: white; }
        .card.black { background: #1d3557; color: white; }
        .card.neutral { background: #f4a261; color: #1d3557; }
        .card.opened { cursor: default; }
        .card.opened:hover { transform: none; border-color: transparent; }
        .controls {
            display: flex; justify-content: center;
            gap: 20px; margin-top: 30px;
        }
        button {
            padding: 12px 30px; border: none;
            border-radius: 25px; background: #7209b7;
            color: white; font-weight: bold;
            cursor: pointer; transition: 0.3s;
        }
        button:hover { background: #560bad; }
        button:disabled { background: #6c757d; cursor: not-allowed; }
        .players { margin-top: 20px; font-size: 0.9em; color: #adb5bd; }
        footer {
            text-align: center; margin-top: 40px;
            color: #6c757d; font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üïµÔ∏è Codenames Online</h1>
            <p>–ò–≥—Ä–∞–π—Ç–µ –≤ Codenames —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞</p>
        </header>
        
        <div class="room-info">
            <div>–ö–æ–º–Ω–∞—Ç–∞: <span id="roomDisplay">–ó–∞–≥—Ä—É–∑–∫–∞...</span></div>
            <div id="connectionStatus" class="status">–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è...</div>
        </div>
        
        <div id="gameArea" style="display: none;">
            <div class="board" id="gameBoard">
                <!-- 25 –∫–∞—Ä—Ç–æ—á–µ–∫ –±—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã JavaScript -->
            </div>
            
            <div class="controls">
                <button id="btnRestart" disabled>–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
                <button id="btnCopyLink">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É</button>
            </div>
            
            <div class="players" id="playerCount">–ò–≥—Ä–æ–∫–æ–≤ –æ–Ω–ª–∞–π–Ω: 1</div>
        </div>
        
        <footer>
            <p>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–æ—Ç–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–º–Ω–∞—Ç—ã ‚Ä¢ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ WebSocket ‚Ä¢ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è</p>
        </footer>
    </div>

    <script>
        // –ü–æ–ª—É—á–∞–µ–º ID –∫–æ–º–Ω–∞—Ç—ã –∏–∑ URL
        const urlParams = new URLSearchParams(window.location.search);
        let roomId = urlParams.get('room');
        
        // –ï—Å–ª–∏ –Ω–µ—Ç –≤ URL - –ø—Ä–æ–≤–µ—Ä—è–µ–º localStorage
        if (!roomId) {
            roomId = localStorage.getItem('last_room');
        }
        
        // –ï—Å–ª–∏ –≤—Å—ë –µ—â—ë –Ω–µ—Ç - –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        if (!roomId) {
            roomId = prompt('–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∫–æ–º–Ω–∞—Ç—ã (–ø–æ–ª—É—á–∏—Ç–µ —É –±–æ—Ç–∞):', '').toUpperCase();
            if (!roomId) {
                document.body.innerHTML = '<div class="container"><h1>‚ùå –¢—Ä–µ–±—É–µ—Ç—Å—è –∫–æ–¥ –∫–æ–º–Ω–∞—Ç—ã</h1><p>–ü–æ–ª—É—á–∏—Ç–µ –∫–æ–¥ —É Telegram –±–æ—Ç–∞ –∫–æ–º–∞–Ω–¥–æ–π /new</p></div>';
                throw new Error('–¢—Ä–µ–±—É–µ—Ç—Å—è –∫–æ–¥ –∫–æ–º–Ω–∞—Ç—ã');
            }
        }
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–ª—è –±—É–¥—É—â–∏—Ö –ø–æ—Å–µ—â–µ–Ω–∏–π
        localStorage.setItem('last_room', roomId);
        document.getElementById('roomDisplay').textContent = roomId;
        
        // –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ WebSocket —Å–µ—Ä–≤–µ—Ä—É
        const renderUrl = 'codenames-u88n.onrender.com'; // –ó–ê–ú–ï–ù–ò–¢–ï –Ω–∞ –≤–∞—à –¥–æ–º–µ–Ω Render
        const wsUrl = `wss://${renderUrl}/ws?room=${roomId}`;
        let socket = null;
        let reconnectAttempts = 0;
        const maxReconnectAttempts = 5;
        
        function connectWebSocket() {
            const statusEl = document.getElementById('connectionStatus');
            statusEl.textContent = '–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É...';
            statusEl.className = 'status';
            
            socket = new WebSocket(wsUrl);
            
            socket.onopen = () => {
                statusEl.textContent = '‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ –∏–≥—Ä–æ–≤–æ–º—É —Å–µ—Ä–≤–µ—Ä—É';
                statusEl.className = 'status connected';
                reconnectAttempts = 0;
                document.getElementById('gameArea').style.display = 'block';
                pingInterval = setInterval(() => {
                    if (socket.readyState === WebSocket.OPEN) {
                        socket.send(JSON.stringify({action: 'ping'}));
                    }
                }, 30000);
            };
            
            socket.onmessage = (event) => {
                try {
                    const data = JSON.parse(event.data);
                    handleServerMessage(data);
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞:', e);
                }
            };
            
            socket.onerror = (error) => {
                console.error('WebSocket –æ—à–∏–±–∫–∞:', error);
                statusEl.textContent = '‚ö†Ô∏è –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è';
                statusEl.className = 'status error';
            };
            
            socket.onclose = (event) => {
                clearInterval(pingInterval);
                statusEl.textContent = '‚ùå –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø—Ä–µ—Ä–≤–∞–Ω–æ';
                statusEl.className = 'status error';
                
                if (reconnectAttempts < maxReconnectAttempts) {
                    reconnectAttempts++;
                    setTimeout(() => {
                        statusEl.textContent = `–ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ (${reconnectAttempts}/${maxReconnectAttempts})...`;
                        connectWebSocket();
                    }, 2000 * reconnectAttempts);
                } else {
                    statusEl.textContent = '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.';
                }
            };
        }
        
        let gameData = null;
        let pingInterval = null;
        
        function handleServerMessage(data) {
            console.log('–ü–æ–ª—É—á–µ–Ω–æ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', data);
            
            switch (data.type) {
                case 'init':
                    gameData = data;
                    renderBoard();
                    break;
                    
                case 'card_opened':
                    if (gameData) {
                        gameData.opened[data.index] = true;
                        updateCard(data.index, data.color);
                    }
                    break;
                    
                case 'player_joined':
                    document.getElementById('playerCount').textContent = 
                        `–ò–≥—Ä–æ–∫–æ–≤ –æ–Ω–ª–∞–π–Ω: ${data.count}`;
                    break;
                    
                case 'game_over':
                    alert(`üéâ –ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! –ü–æ–±–µ–¥–∏–ª–∏: ${data.winner.toUpperCase()} (${data.reason})`);
                    break;
                    
                case 'pong':
                    // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
                    break;
            }
        }
        
        function renderBoard() {
            if (!gameData) return;
            
            const board = document.getElementById('gameBoard');
            board.innerHTML = '';
            
            gameData.words.forEach((word, index) => {
                const card = document.createElement('div');
                card.className = 'card';
                card.textContent = word;
                card.dataset.index = index;
                
                if (gameData.opened[index]) {
                    card.classList.add('opened');
                    card.classList.add(gameData.colors[index]);
                } else {
                    card.onclick = () => {
                        if (socket.readyState === WebSocket.OPEN) {
                            socket.send(JSON.stringify({
                                action: 'click_card',
                                index: index
                            }));
                        }
                    };
                }
                
                board.appendChild(card);
            });
        }
        
        function updateCard(index, color) {
            const cards = document.querySelectorAll('.card');
            if (cards[index]) {
                cards[index].classList.add('opened', color);
                cards[index].onclick = null;
            }
        }
        
        // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏
        document.getElementById('btnCopyLink').onclick = () => {
            const link = window.location.href;
            navigator.clipboard.writeText(link).then(() => {
                alert('‚úÖ –°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä!');
            });
        };
        
        // –ù–∞—á–∏–Ω–∞–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
        connectWebSocket();
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞
        window.addEventListener('focus', () => {
            if (!socket || socket.readyState !== WebSocket.OPEN) {
                if (reconnectAttempts < maxReconnectAttempts) {
                    connectWebSocket();
                }
            }
        });
    </script>
</body>
</html>